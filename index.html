<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>리듬게임</title>
 <style>
    body {
      font-family: 'DNFBitBitv2', sans-serif;
      background-color: black;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    @font-face{
      font-family:'DNFBitBitv2';
      font-style:normal;
      font-weight:400;
      src:url('https://cdn.df.nexon.com/img/common/font/DNFBitBitv2.otf') format('opentype');
    }
    @keyframes highlight {
  0% {
    transform: scale(1);
    color: white;
  }
  50% {
    transform: scale(1.3);
    color: yellow;
  }
  100% {
    transform: scale(1);
    color: white;
  }
}

.highlight {
  animation: highlight 0.5s ease;
}

@keyframes lifeChange {
  0% {
    transform: scale(1) translateX(0);
    color: white;
  }
  10% {
    transform: scale(1.2) translateX(-10px);
    color: red;
  }
  20% {
    transform: scale(1.1) translateX(10px);
    color: white;
  }
  30% {
    transform: scale(1.2) translateX(-10px);
    color: red;
  }
  40% {
    transform: scale(1.1) translateX(10px);
    color: white;
  }
  50% {
    transform: scale(1) translateX(0);
    color: white;
  }
}

.life-change {
  animation: lifeChange 0.5s ease;
}

button {
  border: 2px solid white;
  background-color: black;
  color: white;
  padding: 10px 20px;
  font-size: 16px;
  font-family: 'DNFBitBitv2', sans-serif;
  cursor: pointer;
  transition: all 0.3s ease; /* Smooth transition for hover effect */
}

button:hover {
  background-color: white;
  color: black;
}

    #initialScreen {
      display: flex;
      align-items: center;
      width: 100%;
      height: 100vh;
      z-index: 1;
    }

    .message {
      flex: 1;
      text-align: center;
      font-size: 24px;
      z-index: 1;
    }

    .blinking-text {
      animation: blink 1s step-start infinite;
      font-size: 18px;
      margin-top: 10px;
      color: gray;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    .music-button {
      width: 25%;
      height: 120%;
      cursor: pointer;
      background-size: cover;
      background-position: center;
      z-index: 1;
      transform: skew(-10deg);
      border: 2px solid white;
      background-image: 
        linear-gradient(to right, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0)),
        url('your-image.jpg'); /* 기본 이미지 URL */
      transition: filter 0.3s ease; /* 추가된 부분 */
    }

    .music-button:hover {
      filter: brightness(1.6); /* 마우스 호버 시 밝아짐 */
    }

    .blue {
      background-image: 
        linear-gradient(to right, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0)),
        url('leneda.jpg'); /* 파란색 버튼의 이미지 */
      z-index: 1;
    }
    .red {
      background-image: 
        linear-gradient(to right, rgba(0, 0, 0, 1), rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0)),
        url('starwalk.jpg'); /* 빨간색 버튼의 이미지 */
      z-index: 1;
    }

    #gameBackground {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('space.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      opacity: 0.2; /* 옅은 투명도 설정 */
      z-index: -1;
      display: none; /* 기본적으로 숨김 */
    }

    .lane {
      position: relative;
      width: 160px;
      height: 100vh;
      border: 1px solid white;
      display: inline-block;
      margin: 0 5px;
      overflow: hidden;
      z-index: 1;
    }

    .target {
      position: absolute;
      bottom: 100%;
      width: 100%;
      height: 60px;
      background: linear-gradient(to top, rgba(255, 255, 0, 0.8), rgba(255, 255, 0, 0)); /* 위아래 그라데이션 */
      border-radius: 10px; /* 부드러운 모서리 */
      transition: bottom 2s linear;
      z-index: 1;
    }

    .target.hit {
      background-color: lightgreen;
      box-shadow: 0 0 15px lightgreen;
      transition: opacity 0.5s ease, bottom 2s linear;
      opacity: 0;
      z-index: 1;
    }

    .target.hidden {
      opacity: 0;
      transition: opacity 0.5s ease-out;
      z-index: 1;
    }

    .hitZone {
      position: absolute;
      bottom: 20%;
      width: 100%;
      height: 20%;
      background: linear-gradient(to top, rgba(255, 255, 255, 0.5), rgba(255, 255, 255, 0));
      transition: background 0.3s ease; /* 배경 전환 효과 추가 */
      z-index: 1;
    }

    /* 성공 시 초록색 오버레이 */
    .hitZone.hit-success {
      background: linear-gradient(to top, rgba(0, 255, 0, 0.5), rgba(0, 255, 0, 0));
    }

    /* 실패 시 빨간색 오버레이 */
    .hitZone.hit-fail {
      background: linear-gradient(to top, rgba(255, 0, 0, 0.5), rgba(255, 0, 0, 0));
    }

    #gameContainer {
      display: none;
      position: relative;
      z-index: 1;
    }

    /* 게임 정보 영역 */
    .scoreContainer, .comboContainer, .progressContainer, .lifeContainer {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .scoreContainer {
      left: -200px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 30px;
    }

    .comboContainer {
      right: -200px;
      top: 50%;
      transform: translateY(-50%);
      font-size:30px;
    }

    .progressContainer {
      top: 20px;
      left: -300px; /* 진행도가 라이프 옆에 오도록 설정 */
      font-size: 24px;
      font-weight: bold;
    }

    .lifeContainer {
      top: 20px;
      left: -500px;
      font-size: 24px;
      font-weight: bold;
    }

    #endScreen {
      display: none;
      text-align: center;
    }

    .volume-control {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      color: white;
      font-size: 14px;
      z-index: 2;
    }

    .volume-control input[type="range"] {
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <!-- 초기 화면 -->
  <div id="initialScreen">
    <div class="message" style="margin-top: -300px;">
      <h2 style="font-size: 80px;">NOTE HITTER</h2>
      <div style="border: 1px; color: white;"></div>
      <p style="color: gray;">Press 1, 2, 3, 4 key to hit the note.</p>
      <div class="blinking-text" style="color: white; margin-top:200px;">-Select background music.-</div>
    </div>
    <div class="music-button blue" onclick="startGame(1)"></div>
    <div class="music-button red" onclick="startGame(2)"></div>
  </div>

  <!-- 게임 화면 -->
  <div id="gameContainer">
    <div id="gameBackground"></div>
    <div class="scoreContainer">
      <h2>점수</h2>
      <div id="score" style="font-size: 50px;">0</div>
    </div>
    <div class="comboContainer">
      <h2 >콤보</h2>
      <div id="combo" style="font-size: 50px;">0</div>
    </div>
    <div class="progressContainer">
      <div>진행도</div>
      <div id="progress">0%</div>
    </div>
    <div class="lifeContainer" style="font-style: bold; margin-left: 300px;">
      라이프 <span id="life">10</span>
    </div>
    <div id="lanes">
      <div class="lane" id="lane1"><div class="hitZone"></div></div>
      <div class="lane" id="lane2"><div class="hitZone"></div></div>
      <div class="lane" id="lane3"><div class="hitZone"></div></div>
      <div class="lane" id="lane4"><div class="hitZone"></div></div>
    </div>
  </div>

  <!-- 게임 종료 화면 -->
  <div id="endScreen">
    <h1>게임 종료!</h1>
    <h2>최종 점수: <span id="finalScore">0</span></h2>
    <p>진행도: <span id="finalProgress"></span>%</p>
    <button onclick="retryGame()">다시 도전하기</button>
    <button onclick="goToInitialScreen()">초기화면으로</button>
  </div>
  <div class="volume-control">
    <label for="volumeSlider" style="margin-left: -600px;">볼륨(30% 권장):</label>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="1">
  </div>
  <script>
    const audio = new Audio();
    let score = 0;
    let combo = 0;
    let life = 10;
    let gameInterval;
    const lanes = document.querySelectorAll('.lane');
    const targets = Array(4).fill(null);

    const volumeSlider = document.getElementById('volumeSlider');
    volumeSlider.addEventListener('input', function() {
      audio.volume = volumeSlider.value;
    });

    function startGame(song) {
      clearInterval(gameInterval);  // 기존 인터벌 초기화
      score = 0;
      combo = 0;
      life = 10;
      updateScore();
      updateCombo();
      updateLife();
      audio.src = song === 1 ? 'leneda.mp3' : 'starwalk.mp3';
      audio.volume = volumeSlider.value;
      audio.play();
      document.getElementById('initialScreen').style.display = 'none';
      document.getElementById('gameContainer').style.display = 'block';
      document.getElementById('gameBackground').style.display = 'block';

      gameInterval = setInterval(() => {
        const randomLane = Math.floor(Math.random() * 4);
        if (!targets[randomLane]) {
          createTarget(lanes[randomLane], randomLane);
        }
        const progressPercent = Math.min(100, (audio.currentTime / audio.duration) * 100).toFixed(1);
        updateProgress(progressPercent);
        if (audio.currentTime >= audio.duration) {
          endGame();
        }
      }, 800);
    }

    // 수정된 createTarget 함수
    function createTarget(lane, index) {
      // 현재 진행도 계산
      const progressPercent = (audio.currentTime / audio.duration) * 100;

      // 속도 배율 계산: 1배속에서 최대 1.5배속으로 선형 증가
      const speedMultiplier = 1 + 0.5 * (progressPercent / 100); // 1.0 ~ 1.5

      // 기본 이동 시간 (1x 속도 시 2초)
      const baseDuration = 1.5; // 초

      // 현재 진행도에 따른 이동 시간 계산 (속도 증가 시 시간 감소)
      let duration = baseDuration / speedMultiplier;

      // 약간의 랜덤성을 추가하여 패턴 방지
      duration += (Math.random() * 0.2 - 0.1); // ±0.1초

      // 이동 시간 범위 제한 (예: 1.3초 ~ 2초)
      duration = Math.max(1.0, Math.min(duration, 1.5));

      // 노트 생성 및 스타일 설정
      const target = document.createElement('div');
      target.classList.add('target');
      target.style.transition = `bottom ${duration}s linear`;
      lane.appendChild(target);
      targets[index] = target;

      // 약간의 지연 후 노트 이동 시작
      setTimeout(() => { target.style.bottom = '0'; }, 50);

      // 이동 완료 시 이벤트 처리
      target.addEventListener('transitionend', () => {
        if (!target.classList.contains('hit')) {
          targets[index] = null;
          target.remove();
          life--;
          updateLife();
          triggerHitZoneEffect(lane, 'fail'); // 틀렸을 때 효과
          if (life <= 0) { endGame(); }
        }
      });
    }

    function updateScore() {
      document.getElementById('score').textContent = score;
    }

    function updateCombo() {
      document.getElementById('combo').textContent = combo;
    }

    function updateProgress(progressPercent) {
      document.getElementById('progress').textContent = `${progressPercent}%`;
    }

    function updateLife() {
      document.getElementById('life').textContent = life;
    }

    function endGame() {
      clearInterval(gameInterval);  // 게임 종료 시 인터벌 초기화
      audio.pause();
      document.getElementById('gameContainer').style.display = 'none';
      document.getElementById('endScreen').style.display = 'block';
      document.getElementById('finalScore').textContent = score;

      // 최종 진행도 계산 및 표시
      const finalProgress = Math.min(100, (audio.currentTime / audio.duration) * 100).toFixed(1);
      document.getElementById('finalProgress').textContent = finalProgress;
    }

    function retryGame() {
      clearInterval(gameInterval);  // 이전 게임의 인터벌 초기화
      document.getElementById('endScreen').style.display = 'none';
      document.getElementById('gameContainer').style.display = 'block';
      
      // 노트 초기화
      lanes.forEach((lane, index) => {
        if (targets[index]) {
          targets[index].remove();
          targets[index] = null;
        }
        const hitZone = lane.querySelector('.hitZone');
        hitZone.classList.remove('hit-success', 'hit-fail'); // 클래스 제거
      });

      startGame(1); // 기본적으로 첫 번째 음악으로 재시작
    }

    function goToInitialScreen() {
      clearInterval(gameInterval);  // 초기 화면으로 돌아갈 때 인터벌 초기화
      document.getElementById('endScreen').style.display = 'none';
      document.getElementById('initialScreen').style.display = 'flex';
    }

    // 히트존 효과 트리거 함수
    function triggerHitZoneEffect(lane, result) {
      const hitZone = lane.querySelector('.hitZone');
      if (result === 'success') {
        hitZone.classList.add('hit-success');
        setTimeout(() => {
          hitZone.classList.remove('hit-success');
        }, 300); // 0.3초 후 원상복귀
      } else if (result === 'fail') {
        hitZone.classList.add('hit-fail');
        setTimeout(() => {
          hitZone.classList.remove('hit-fail');
        }, 300); // 0.3초 후 원상복귀
      }
    }

    // 키 입력 인식
    document.addEventListener('keydown', (event) => {
      const keyMap = {
        '1': 0,
        '2': 1,
        '3': 2,
        '4': 3
      };
      const laneIndex = keyMap[event.key];

      if (laneIndex !== undefined) {
          const lane = lanes[laneIndex];
          if (targets[laneIndex]) {
              // 올바른 키 입력
              targets[laneIndex].classList.add('hit'); // 이펙트 적용
              targets[laneIndex].classList.add('hidden'); // 타격 후 숨기기
              targets[laneIndex] = null;
              score += 10;
              combo += 1;
              updateScore();
              updateCombo();
              triggerHitZoneEffect(lane, 'success'); // 성공 시 효과
          } else {
              // 잘못된 키 입력
              life--;
              updateLife();
              combo = 0; // 콤보 초기화
              updateCombo();
              triggerHitZoneEffect(lane, 'fail'); // 실패 시 효과
              if (life <= 0) { endGame(); }
          }
      }
    });

    // 애니메이션 트리거를 위한 변수
let lastScoreThreshold = 0;
let lastComboThreshold = 0;

function updateScore() {
  document.getElementById('score').textContent = score;
  checkScoreThreshold();
}

function updateCombo() {
  document.getElementById('combo').textContent = combo;
  checkComboThreshold();
}

// 점수 및 콤보가 100의 배수를 넘었는지 확인하고 애니메이션 트리거
function checkScoreThreshold() {
  if (score >= lastScoreThreshold + 100) {
    lastScoreThreshold += 100;
    triggerHighlight('score');
  }
}

function checkComboThreshold() {
  if (combo >= lastComboThreshold + 100) {
    lastComboThreshold += 100;
    triggerHighlight('combo');
  }
}

// 애니메이션 트리거 함수
function triggerHighlight(elementId) {
  const element = document.getElementById(elementId);
  element.classList.add('highlight');
  setTimeout(() => {
    element.classList.remove('highlight');
  }, 500); // 애니메이션 지속 시간과 일치
}

function triggerLifeChange() {
  const lifeElement = document.getElementById('life');
  lifeElement.classList.add('life-change');
  setTimeout(() => {
    lifeElement.classList.remove('life-change');
  }, 500); // 애니메이션 지속 시간과 일치
}
    function updateLife() {
  const lifeElement = document.getElementById('life');
  lifeElement.textContent = life;
  triggerLifeChange(); // 라이프가 업데이트 될 때 애니메이션 트리거
}
  </script>
</body>
</html>
